<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Justin's Code Haus</title><link href="http://blog.jholewinski.org/" rel="alternate"></link><link href="http://blog.jholewinski.org/feeds/all.atom.xml" rel="self"></link><id>http://blog.jholewinski.org/</id><updated>2012-11-06T01:27:00+01:00</updated><entry><title>2012 and still no multi-monitor lovin'...</title><link href="http://blog.jholewinski.org/2012-and-still-no-multi-monitor-lovin/index.html" rel="alternate"></link><updated>2012-11-06T01:27:00+01:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2012-11-06:2012-and-still-no-multi-monitor-lovin/index.html</id><summary type="html">&lt;p&gt;For the past week, I've been giving Windows 8 a serious try. &amp;nbsp;I've
dabbled with the various preview versions, but now it's time to try the
released version. &amp;nbsp;I've read the reviews, saw the mixed reactions to the
new &amp;quot;Modern UI&amp;quot;, and decided to see for myself how I feel about
it.&amp;nbsp;Generally speaking, I don't mind the new interface. &amp;nbsp;My usual method
of launching a program was pressing the Win key, typing the first few
letters of the application name, and then hitting Enter. &amp;nbsp;Still works in
the Start Screen. &amp;nbsp;Start Menu vs. Start Screen, it doesn't bother me.
&amp;nbsp;Except for one little detail...&lt;/p&gt;
&lt;p&gt;&lt;em&gt;... the complete lack of multi-monitor support in the Modern UI!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Simply put, there can only be one full-screen Modern UI app displayed at
a time. &amp;nbsp;So if I open, say, Mail on one screen and attempt to open Maps
on another screen, the screen showing Mail will go back to the desktop.
&amp;nbsp;To make matters worse, the Start Screen counts as a Modern UI app in
this regard. &amp;nbsp;If I have Mail open on one screen and try to open the
Start Screen on another screen to launch an application, the screen
showing Mail goes back to the desktop and I have to alt+tab back to it.
&amp;nbsp;Talk about a disruption in my workflow!&lt;/p&gt;
&lt;p&gt;Did I mention my main desktop is triple-head? &amp;nbsp;It comes in handy for
coding. &amp;nbsp;All of the Windows 8 reviews I read talk about the pros and
cons of the new Modern UI, but I rarely see any reference to the
complete lack of multi-monitor support in it. &amp;nbsp;I'm not sure if this is
just a feature oversight, or a more fundamental limitation in the model
used for WinRT apps. &amp;nbsp; Is there a fundamental technical limitation in
the operating system that prevents multiple Modern UI apps to be visible
at the same time? If the Modern UI is the future, I sure hope they get
this fixed ASAP! &amp;nbsp;For now, it's easy enough to just avoid Modern UI apps
altogether, but what happens in the future when I find an app I want to
keep open on one of my screens?&lt;/p&gt;
&lt;p&gt;Perhaps more disturbing, this is becoming a trend in mainstream
operating systems. &amp;nbsp;While Windows 8 has this limitation for Modern UI
apps, full-screen apps in Mac OS X are not really any better. &amp;nbsp;If I
full-screen an application in a multi-monitor configuration, I get that
app on one monitor and a pretty background on all others. &amp;nbsp;I would much
rather have the ability to put multiple apps in full-screen mode
side-by-side, or perhaps have the option to have a full-screen app next
to a desktop workspace on another monitor. &amp;nbsp;At least I can have multiple
workspaces, though.&lt;/p&gt;
&lt;p&gt;Perhaps I'm just too adjusted to my Linux multi-monitor
configurations...&lt;/p&gt;
</summary><category term="Windows"></category><category term="Desktop"></category></entry><entry><title>UnrealScript: Brace Placement Matters!</title><link href="http://blog.jholewinski.org/unrealscript-brace-placement-matters/index.html" rel="alternate"></link><updated>2012-03-17T00:22:00+01:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2012-03-17:unrealscript-brace-placement-matters/index.html</id><summary type="html">&lt;p&gt;I was playing around with the Unreal Development Kit this evening, and
discovered a rather interesting quirk in the handling of braces within
UnrealScript. &amp;nbsp;All of the sample code I read use a syntax style that
places opening braces on the following line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="n"&gt;PostBeginPlay&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Do something&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, my typical style places the opening brace on the current line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="n"&gt;PostBeginPlay&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Do something&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Unfortunately, this does not seem to work for &lt;tt class="docutils literal"&gt;defaultproperties&lt;/tt&gt;
blocks. If you place the brace on the same line, the compiler will not
give you any warnings or errors, but the entire &lt;tt class="docutils literal"&gt;defaultproperties&lt;/tt&gt;
block is just ignored!&lt;/p&gt;
&lt;p&gt;So this code works:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;defaultproperties
{
  PlayerControllerClass=class&amp;#39;MyPlayerController&amp;#39;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;while the following code compiles but silently just ignores all of the
contained settings:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;defaultproperties {
  PlayerControllerClass=class&amp;#39;MyPlayerController&amp;#39;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I was banging my head on the wall for at least an hour figuring this one
out!&lt;/p&gt;
&lt;p&gt;I hope this can help prevent someone else from repeating my mistake.&lt;/p&gt;
</summary><category term="Unreal"></category></entry><entry><title>Space Hogs Binary Release</title><link href="http://blog.jholewinski.org/space-hogs-binary-release/index.html" rel="alternate"></link><updated>2012-02-17T12:35:00+01:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2012-02-17:space-hogs-binary-release/index.html</id><summary type="html">&lt;p&gt;I've converted my old Space Hogs game project to XNA 4.0 (it was
originally written in XNA 1.0). There were enough API changes to make it
a pain, but I think I have everything working now.&lt;/p&gt;
&lt;p&gt;This game was developed by myself, Jason Kim, Joseph Ahn, Vjekoslav
Kovacevic, and Daniel Guinn for a computer animation class during Winter
Quarter 2007.&lt;/p&gt;
&lt;a class="reference external image-reference" href="http://blog.jholewinski.org/static/images/spacehogs-screen1.png"&gt;&lt;img alt="Spacehogs Screenshot" src="http://blog.jholewinski.org/static/images/spacehogs-screen1.png" style="width: 600px;" /&gt;&lt;/a&gt;
&lt;p&gt;You can find a zip file &lt;a class="reference external" href="/static/SpaceHogs.zip"&gt;here&lt;/a&gt;. This requires XNA 4.0 and the February
2010 DX packages to be installed on your machine. For convenience, I've
included both of the redistributable packages in the zip file.&lt;/p&gt;
&lt;p&gt;The source can be found on &lt;a class="reference external" href="https://bitbucket.org/jholewinski/space-hogs"&gt;BitBucket&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;
</summary><category term="Windows"></category><category term="Games"></category></entry><entry><title>Direct3D 11 with Qt 4</title><link href="http://blog.jholewinski.org/direct3d-11-with-qt-4/index.html" rel="alternate"></link><updated>2012-02-16T15:12:00+01:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2012-02-16:direct3d-11-with-qt-4/index.html</id><summary type="html">&lt;p&gt;(If you're in a hurry, the full source can be found on my &lt;a class="reference external" href="https://bitbucket.org/jholewinski/qt4-d3d11"&gt;BitBucket&lt;/a&gt;
account)&lt;/p&gt;
&lt;p&gt;When it comes to GUI frameworks for C++, it's very hard to beat &lt;a class="reference external" href="http://qt.nokia.com"&gt;Qt&lt;/a&gt;.
&amp;nbsp;It's modular, easy to use, and available on practically any desktop
system (and even a few mobile systems). &amp;nbsp;The MOC'ing can get a bit
annoying, but IDE and command-line support is very mature at this point.
&amp;nbsp;However, only OpenGL is supported currently for real-time 3D rendering.
If you want to render to a Qt widget from a Direct3D 11 device, you end
up having to do a lot of setup yourself.&lt;/p&gt;
&lt;p&gt;Unfortunately, there is not a lot of information out on the internet
about setting up Direct3D to play nice with Qt. &amp;nbsp;Most of the information
is either out-dated, or only applies to Direct3D 9. &amp;nbsp;Lately, I've been
playing around with this and I want to share my method for combining
Direct3D 11 and Qt.&lt;/p&gt;
&lt;a class="reference external image-reference" href="http://blog.jholewinski.org/static/images/qtd3d11-screen1.png"&gt;&lt;img alt="Screenshot" src="http://blog.jholewinski.org/static/images/qtd3d11-screen1.png" /&gt;&lt;/a&gt;
&lt;div class="section" id="creating-a-widget"&gt;
&lt;h2&gt;Creating a Widget&lt;/h2&gt;
&lt;p&gt;To start, we define a new widget sub-class specifically for Direct3D 11
rendering. On the Qt side, the key to eliminating flickering or UI
artifacts is the &lt;tt class="docutils literal"&gt;paintEngine()&lt;/tt&gt; method. &amp;nbsp;We need a way to tell Qt
that we want complete control over drawing for our widget, so we can
override &lt;tt class="docutils literal"&gt;paintEngine()&lt;/tt&gt; in our widget definition:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;D3DRenderWidget&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="n"&gt;QWidget&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Q_OBJECT&lt;/span&gt;
  &lt;span class="n"&gt;Q_DISABLE_COPY&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;D3DRenderWidget&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;public&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;D3DRenderWidget&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QWidget&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;parent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;virtual&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;D3DRenderWidget&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="k"&gt;virtual&lt;/span&gt; &lt;span class="n"&gt;QPaintEngine&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;paintEngine&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;protected&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="k"&gt;virtual&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;resizeEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QResizeEvent&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;virtual&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;paintEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QPaintEvent&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;(Note that for ease of viewing, all of the fields have been removed from
this code snippet)&lt;/p&gt;
&lt;p&gt;We also need to set a few attributes on our widget, as shown in the
constructor:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7
8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;D3DRenderWidget&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;D3DRenderWidget&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QWidget&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;QWidget&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;setAttribute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Qt&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;WA_PaintOnScreen&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;setAttribute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Qt&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;WA_NativeWindow&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="c1"&gt;// Create Device&lt;/span&gt;
  &lt;span class="n"&gt;createDevice&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;First, we tell Qt that we do not want it to do any draw buffering for
us. Second, we require a native window handle for our widget. Otherwise,
Qt may re-use the same native handle for multiple widgets and cause
problems for our Direct3D rendering. You may have also noticed the
&lt;tt class="docutils literal"&gt;createDevice()&lt;/tt&gt; method call; this will be explained in a bit.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="creating-the-direct3d-11-device"&gt;
&lt;h2&gt;Creating the Direct3D 11 Device&lt;/h2&gt;
&lt;p&gt;Now that we have a basic widget that can support Direct3D rendering, we
can initialize the Direct3D 11 device we want. This procedure is mostly
identical to setting up Direct3D in a raw window. The only difference is
that we must use the &lt;tt class="docutils literal"&gt;width()&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;height()&lt;/tt&gt;, and &lt;tt class="docutils literal"&gt;winId()&lt;/tt&gt; methods
to return the widget size and native window handle, respectively:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferCount&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Width&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Format&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DXGI_FORMAT_R8G8B8A8_UNORM&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferUsage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DXGI_USAGE_RENDER_TARGET_OUTPUT&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SampleDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SampleDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Quality&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Windowed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;OutputWindow&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;winId&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RefreshRate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Numerator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;RefreshRate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Denominator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;Everything else remains the same... pretty easy, huh? :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="handling-paint-events"&gt;
&lt;h2&gt;Handling Paint Events&lt;/h2&gt;
&lt;p&gt;Remember the &lt;tt class="docutils literal"&gt;paintEvent&lt;/tt&gt; override from the widget class definition?
We can simply implement it with a call to some rendering function:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;D3DRenderWidget&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;paintEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QPaintEvent&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;render&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;Here, &lt;tt class="docutils literal"&gt;render()&lt;/tt&gt; is just some arbitrary method that uses the Direct3D
11 device to render something to the primary swap chain.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="handling-resize-events"&gt;
&lt;h2&gt;Handling Resize Events&lt;/h2&gt;
&lt;p&gt;Resize events are perhaps the hardest events to handle when integrating
Direct3D 11 and Qt. To resize our swap chain, we need to release all
device-allocated resources, and reallocate them. The procedure I follow
is:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;1
2
3
4
5
6
7
8&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;D3DRenderWidget&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;resizeEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;QResizeEvent&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;releaseBuffers&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="n"&gt;swapChain_&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;ResizeBuffers&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BufferDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Format&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;swapChain_&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;GetDesc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;swapChainDesc_&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;viewport_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Width&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="n"&gt;viewport_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="n"&gt;createBuffers&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;We start by releasing all of the buffers we had allocated (vertex
buffers, index buffers, shaders, textures, etc.). We then issue a resize
request to the swap chain, resize our rendering viewport, and then
recreate all of our needed buffers. In this snippet,
&lt;tt class="docutils literal"&gt;releaseBuffers()&lt;/tt&gt; will call &lt;tt class="docutils literal"&gt;Release()&lt;/tt&gt; on all buffers, and
&lt;tt class="docutils literal"&gt;createBuffers()&lt;/tt&gt; will create all of the needed resources (again).&lt;/p&gt;
&lt;p&gt;It would probably be easier to just allow the swap chain to grow and
just adjust the viewport if the widget shrinks, but this method shows
how to keep the swap chain the exact same size as the widget.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;At this point, you should have a functional Direct3D 11 rendering
context for a Qt widget. For brevity, I have omitted most of the
Direct3D initialization code (this can be found in many places on the
web).&lt;/p&gt;
&lt;p&gt;If you want to check out the complete sample program, it is located on
my &lt;a class="reference external" href="https://bitbucket.org/jholewinski/qt4-d3d11"&gt;BitBucket&lt;/a&gt; account. To build it, you need a relatively recent Qt
release, the DirectX SDK, and the Qt Visual Studio Add-in.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="Direct3D"></category><category term="Qt"></category><category term="Windows"></category><category term="C++"></category></entry><entry><title>AMD APP: Getting Device Assembly</title><link href="http://blog.jholewinski.org/amd-app-getting-device-assembly/index.html" rel="alternate"></link><updated>2012-02-09T13:01:00+01:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2012-02-09:amd-app-getting-device-assembly/index.html</id><summary type="html">&lt;p&gt;Sometimes it is useful to look at the intermediate and assembly code for
GPU programs. &amp;nbsp;This can lead to some interesting performance insights,
especially for compiler writers. &amp;nbsp;Unfortunately, the AMD APP SDK is a
bit limited on Linux, and the AMD APP KernelAnalyzer, which conveniently
dumps the AMDIL and Device ISA for an OpenCL kernel, is not available on
Linux. &amp;nbsp;However, digging through the AMD APP OpenCL Programming Guide,
one finds an environment variable that can be used for the same purpose:
&lt;tt class="docutils literal"&gt;GPU_DUMP_DEVICE_KERNEL&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;According to the programming guide, this environment variable can take
one of three values:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="8%" /&gt;
&lt;col width="92%" /&gt;
&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Save intermediate IL files in local directory.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;Disassemble ISA file and save in local directory.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;Save both the IL and ISA files in local directory.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Therefore, if you run your OpenCL program with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ GPU_DUMP_DEVICE_KERNEL=3 ./my-program
&lt;/pre&gt;
&lt;p&gt;You will get two files in your local directory:
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;[kernel-name]_[device-name].il&lt;/span&gt;&lt;/tt&gt; and
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;[kernel-name]_[device-name].isa&lt;/span&gt;&lt;/tt&gt;, which contain AMDIL and Device ISA
disassembly, respectively.&lt;/p&gt;
</summary><category term="GPU"></category><category term="OpenCL"></category><category term="AMD"></category></entry><entry><title>LLVM 3.0: PTX Backend</title><link href="http://blog.jholewinski.org/llvm-3-0-ptx-backend/index.html" rel="alternate"></link><updated>2011-12-02T11:17:00+01:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2011-12-02:llvm-3-0-ptx-backend/index.html</id><summary type="html">&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;: The information is this article only applies to LLVM 3.0 and
3.1. As of LLVM 3.2, the PTX back-end has been replaced with the NVPTX
back-end.&lt;/p&gt;
&lt;p&gt;With the release of LLVM 3.0, the PTX back-end is now in a fairly usable
state. &amp;nbsp;It even integrates with the Clang OpenCL front-end to produce
correct PTX code usable by the nVidia OpenCL run-time. &amp;nbsp;However, please
note that the back-end is still experimental and there are unimplemented
features. &amp;nbsp;As always, please post any questions to the llvm-dev mailing
list.&lt;/p&gt;
&lt;p&gt;In this post, I aim to give a quick overview of how to use the back-end
to compile OpenCL kernels.&lt;/p&gt;
&lt;p&gt;As an example, consider the following matrix multiplication routine
written in OpenCL:&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;#define BLOCK_SIZE 16&lt;/span&gt;

&lt;span class="n"&gt;__kernel&lt;/span&gt;
&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;matmul&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__global&lt;/span&gt; &lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;__global&lt;/span&gt; &lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;__global&lt;/span&gt; &lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

  &lt;span class="n"&gt;__local&lt;/span&gt; &lt;span class="kt"&gt;float&lt;/span&gt; &lt;span class="n"&gt;scratchA&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="n"&gt;__local&lt;/span&gt; &lt;span class="kt"&gt;float&lt;/span&gt; &lt;span class="n"&gt;scratchB&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;globalX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_global_id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;globalY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_global_id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_global_size&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;float&lt;/span&gt; &lt;span class="n"&gt;sum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.0f&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;numBlocks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;tidX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_local_id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;tidY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_local_id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;numBlocks&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Populate a cache for A/B&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;tidX&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;globalY&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;scratchA&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;tidY&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;tidX&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;globalX&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;tidY&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;scratchB&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;tidY&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;tidX&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

    &lt;span class="n"&gt;barrier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CLK_LOCAL_MEM_FENCE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;BLOCK_SIZE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kt"&gt;float&lt;/span&gt; &lt;span class="n"&gt;myA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="kt"&gt;float&lt;/span&gt; &lt;span class="n"&gt;myB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

      &lt;span class="n"&gt;myA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scratchA&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;tidY&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
      &lt;span class="n"&gt;myB&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scratchB&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;tidX&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

      &lt;span class="n"&gt;sum&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;myA&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;myB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;barrier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CLK_LOCAL_MEM_FENCE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;globalY&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;globalX&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;We can use the &lt;a class="reference external" href="http://www.pcc.me.uk/~peter/libclc"&gt;libclc&lt;/a&gt;&amp;nbsp;library, written by Peter Collingbourne, to
provide the OpenCL built-in functions for Clang. &amp;nbsp;This library will map
OpenCL built-in functions to target-specific functions in the LLVM IR
that the PTX back-end knows how to handle. &amp;nbsp;If &lt;tt class="docutils literal"&gt;$LIBCLC&lt;/tt&gt; points to the
download of libclc, then you can invoke Clang with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
clang -ccc-host-triple ptx32
  -Xclang -target-feature -Xclang +ptx23
  -Xclang -target-feature -Xclang +sm20
  -I$LIBCLC/include/generic -I$LIBCLC/include/ptx
  -include clc/clc.h -Dcl_clang_storage_class_specifiers
  -O3 matmul_kernel.cl -S -o matmul_kernel.ptx
&lt;/pre&gt;
&lt;p&gt;The options can be a bit verbose at the moment, but practically all of
them can be placed in a wrapper script. &amp;nbsp;Clang will compile the kernel
and emit the generated PTX code to &lt;tt class="docutils literal"&gt;matmul_kernel.ptx&lt;/tt&gt;. &amp;nbsp;This code can
then be loaded as an OpenCL binary kernel using the nVidia OpenCL SDK,
using the &lt;tt class="docutils literal"&gt;clCreateProgramWithBinary&lt;/tt&gt; function. &amp;nbsp;As an added bonus,
the performance is about the same as if the kernel was compiled using
the nVidia OpenCL compiler!&lt;/p&gt;
</summary><category term="GPU"></category><category term="LLVM"></category><category term="OpenCL"></category></entry><entry><title>Installing Matplotlib on OS X 10.7 with Homebrew</title><link href="http://blog.jholewinski.org/installing-matplotlib-on-os-x-10-7-with-homebrew/index.html" rel="alternate"></link><updated>2011-07-21T14:32:00+02:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2011-07-21:installing-matplotlib-on-os-x-10-7-with-homebrew/index.html</id><summary type="html">&lt;p&gt;[edit: It looks like things have changed a bit since the release of
10.7, so your mileage may vary with this method. &amp;nbsp;This was written when
10.7 was brand new and most software was not yet updated for it.]&lt;/p&gt;
&lt;p&gt;For those of you that do not know, &lt;a class="reference external" href="http://matplotlib.sourceforge.net"&gt;Matplotlib&lt;/a&gt; is an excellent Python
plotting library that allows you to create professional-quality plots
for inclusion on web pages, Latex documents, Beamer presentations,
Keynote presentations, and any other software that can import SVG, EPS,
PNG, or virtually any graphic format.&lt;/p&gt;
&lt;p&gt;However, getting matplotlib installed on Mac OS X 10.7 can be a bit
tricky, especially if you are using &lt;a class="reference external" href="http://mxcl.github.com/homebrew/"&gt;Homebrew&lt;/a&gt; as your &amp;quot;package
manager.&amp;quot; &amp;nbsp;First off, Homebrew does not have packages for matplotlib, as
well as some of its dependencies. &amp;nbsp;Additionally, the current Matplotlib
release version (1.0.1 as of this post) does not compile out-of-the-box
against libpng 1.5, which is included in the X11 distribution shipped
with Mac OS X 10.7.&lt;/p&gt;
&lt;p&gt;For previous versions of Mac OS X (10.6, 10.5), the usual way to install
matplotlib was to install python, pkg-config, and gfortran with
Homebrew, then install numpy and matplotlib through pip, ala:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ brew install python
$ brew install gfortran
$ brew install pkg-config
$ easy_install pip
$ pip install numpy
$ pip install matplotlib
&lt;/pre&gt;
&lt;p&gt;Unfortunately, as previously mentioned, all is not so easy in the world
of Mac OS X 10.7, and the difficulty lies with libpng 1.5, installed
with Mac OS X 10.7's version of X11. Briefly put, Matplotlib 1.0.1 is
not compatible with libpng 1.5 due to a change in the API. Fortunately,
the fix is already applied up-stream and will probably be a part of
Matplotlib 1.0.2, or 1.1.0, or whatever the next released version is.&lt;/p&gt;
&lt;p&gt;Until the next release, the Matplotlib sources in Git can be used.
Instead of pulling the sources from the Matplotlib SourceForge site, you
need to pull them from the Matplotlib GitHub site. I'm not sure if this
GitHub site is &amp;quot;official,&amp;quot; but is looks to be.&lt;/p&gt;
&lt;p&gt;All that is needed is to build Matplotlib from source instead of using
pip, so the installation procedure is now:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ brew install python
$ brew install gfortran
$ brew install pkg-config
$ easy_install pip
$ pip install numpy
$ cd $HOME
$ git clone https://github.com/matplotlib/matplotlib.git
$ cd matplotlib
$ python setup.py build
$ python setup.py install
&lt;/pre&gt;
&lt;p&gt;And now you're good to go! Hopefully this will become much easier with
the next official release of Matplotlib.&lt;/p&gt;
</summary><category term="Homebrew"></category><category term="Mac OS X"></category><category term="Matplotlib"></category></entry><entry><title>The Beauty of C++ Templates</title><link href="http://blog.jholewinski.org/the-beauty-of-c-templates/index.html" rel="alternate"></link><updated>2011-04-01T12:50:00+02:00</updated><author><name>Justin Holewinski</name></author><id>tag:blog.jholewinski.org,2011-04-01:the-beauty-of-c-templates/index.html</id><summary type="html">&lt;p&gt;Every so often, I'll get a random C++ question from a friend or
colleague. &amp;nbsp;Most of the time the answers are trivial, at least for
someone who has a history with the language. &amp;nbsp;Other questions make me
stop and ponder, searching for the best &amp;quot;C++&amp;quot; way to do something.
&amp;nbsp;Yesterday, the question was simple and the solution turned out to be
equally simple, but getting to the solution made me stop and appreciate
some of the cool things one can do with C++ templates.&lt;/p&gt;
&lt;div class="section" id="the-problem"&gt;
&lt;h2&gt;The Problem&lt;/h2&gt;
&lt;p&gt;The problem was simple. &amp;nbsp;Suppose you have a C++ template class/struct
that is parameterized by a single type, e.g.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;my_data&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// ...&lt;/span&gt;
&lt;span class="k"&gt;private&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="n"&gt;element_&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="the-solution"&gt;
&lt;h2&gt;The Solution&lt;/h2&gt;
&lt;p&gt;Now, the question is, &amp;quot;how do I write a method for this class/struct
that maps the type of T to an enumeration value?&amp;quot; &amp;nbsp;For context, the real
problem involved mapping T to an MPI data type, e.g. (float -&amp;gt;
MPI_FLOAT), (double -&amp;gt; MPI_DOUBLE), etc..&lt;/p&gt;
&lt;p&gt;The first thought for anyone familiar with containers may be to
explicitly generate a map, e.g. std::map in this case, to hold all
possible mappings from the C++ type (via typeid()) to the MPI type
(really just an integer). &amp;nbsp;Such a solution is certainly valid and may be
the best way to approach the problem in another language such as C# or
Java. &amp;nbsp;After pondering the &amp;quot;C++&amp;quot; solution to the problem for a few
minutes, my colleague and I came up with a fairly elegant solution
involving templates. &amp;nbsp;Or, at least I found it quite elegant.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt; * This struct wrappers the MPI data type value for the given C++ type.&lt;/span&gt;
&lt;span class="cm"&gt; *&lt;/span&gt;
&lt;span class="cm"&gt; * Any valid MPI data type value must have a corresponding explicit template&lt;/span&gt;
&lt;span class="cm"&gt; * instantiation below.&lt;/span&gt;
&lt;span class="cm"&gt; */&lt;/span&gt;
&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;mpi_type_wrapper&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;mpi_type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="n"&gt;mpi_type_wrapper&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="c1"&gt;// Explicit instantiation for `float&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;
&lt;span class="n"&gt;mpi_type_wrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;mpi_type_wrapper&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mpi_type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MPI_FLOAT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;

&lt;span class="c1"&gt;// Explicit instantiation for `double&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;template&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;
&lt;span class="n"&gt;mpi_type_wrapper&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;mpi_type_wrapper&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mpi_type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MPI_DOUBLE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The mpi_type_wrapper struct is a convenient way to convert an
arbitrary C++ type to an equivalent MPI type. &amp;nbsp;All one has to do is
declare a local variable of type mpi_type_wrapper&amp;lt;T&amp;gt; (with appropriate
T) and read the value of its mpi_type field. &amp;nbsp;Of course, none of this
is specific to MPI in any way. &amp;nbsp;The only requirement is that an explicit
instantiation of the constructor must be provided for any C++ types that
are to be converted.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-this-solution"&gt;
&lt;h2&gt;Why This Solution?&lt;/h2&gt;
&lt;p&gt;This solution strikes me as elegant for two reasons. &amp;nbsp;First, it is a
solution that would be difficult, if not impossible, to express in many
other languages. &amp;nbsp;Second, and most interesting to me, there is &lt;em&gt;no&lt;/em&gt;
run-time overhead associated with this solution. &amp;nbsp;You can even compile
this with RTTI turned off. &amp;nbsp;Any reasonable compiler automatically
inlines the appropriate constructor, then constant propagation replaces
any uses of the mpi_type field with the appropriate MPI_* enumeration
value. &amp;nbsp;There is no memory overhead associated with explicitly keeping a
map at run-time, nor any time overhead of performing a map look-up. &amp;nbsp;The
final code just uses the constant value! &amp;nbsp;If you do not believe me,
check out this example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt; * Some template class that needs to know the MPI_DataType value for its&lt;/span&gt;
&lt;span class="cm"&gt; * template parameter type.&lt;/span&gt;
&lt;span class="cm"&gt; */&lt;/span&gt;
&lt;span class="k"&gt;template&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;typename&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;some_type&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;printType&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;mpi_type_wrapper&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;My Type: %d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;wrap&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mpi_type&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;some_type&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;floatClass&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="n"&gt;some_type&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;double&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;doubleClass&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="n"&gt;floatClass&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;printType&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="n"&gt;doubleClass&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;printType&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And the generated code?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nl"&gt;_main:&lt;/span&gt;
  &lt;span class="nf"&gt;pushq&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rbx&lt;/span&gt;
  &lt;span class="nf"&gt;leaq&lt;/span&gt; &lt;span class="nv"&gt;L_.str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rip&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rbx&lt;/span&gt;
  &lt;span class="nf"&gt;movq&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rbx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rdi&lt;/span&gt;
  &lt;span class="nf"&gt;xorl&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;esi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;esi&lt;/span&gt;
  &lt;span class="nf"&gt;xorb&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;al&lt;/span&gt;
  &lt;span class="nf"&gt;callq&lt;/span&gt; &lt;span class="nv"&gt;_printf&lt;/span&gt;
  &lt;span class="nf"&gt;movl&lt;/span&gt; &lt;span class="kc"&gt;$&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;esi&lt;/span&gt;
  &lt;span class="nf"&gt;movq&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rbx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rdi&lt;/span&gt;
  &lt;span class="nf"&gt;xorb&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;al&lt;/span&gt;
  &lt;span class="nf"&gt;callq&lt;/span&gt; &lt;span class="nv"&gt;_printf&lt;/span&gt;
  &lt;span class="nf"&gt;xorl&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nb"&gt;eax&lt;/span&gt;
  &lt;span class="nf"&gt;popq&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;rbx&lt;/span&gt;
  &lt;span class="nf"&gt;ret&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;While this example is probably trivial for most experienced C++
programmers out there, including myself, I always find myself stopping
and appreciating such solutions. &amp;nbsp;In this case, C++ templates provide
such an elegant and efficient solution that I cannot help feeling giddy.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="C++"></category></entry></feed>